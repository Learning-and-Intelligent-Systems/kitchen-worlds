<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../css/favicon.ico" />
    <title>II) Operators - Dev Notes</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../css/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "II) Operators";
        var mkdocs_page_input_path = "domain-operators.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Dev Notes
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Project</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="..">Kitchen Worlds</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../project-challenges/">Challenges of TAMP</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Planning Domains</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../domain-rearrangement/">Rearrangement Domain</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../domain-predicates/">I) Predicates</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">II) Operators</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#operators-for-general-purpose-skills">Operators for General-Purpose Skills</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#pick">Pick</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#place">Place</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#grasp-handle">Grasp Handle</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#pull-handle">Pull Handle</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#operators-for-symbolic-goals">Operators for Symbolic Goals</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#references">References</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../domain-axioms/">III) Axioms</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Planning Approach</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../planner-baselines/">Baseline Planners</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Experiments</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../exp-problems/">Planning Problems</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Set it up</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../setup-repository/">Set up the Repository</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../setup-mkdocs/">Set up MkDocs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../setup-notes/">Editor's Notes</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Tutorials</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../tut-lisdf/">LISDF</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tut-lispddl/">LISPDDL</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tut-pddlstream/">PDDLStream</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Dev Notes</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Planning Domains &raquo;</li><li>II) Operators</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>

          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="ii-operators">II) Operators<a class="headerlink" href="#ii-operators" title="Permanent link">#</a></h1>
<p>The skills and corresponding constraints with the world are included in the domain via PDDL operators.</p>
<h2 id="operators-for-general-purpose-skills">Operators for General-Purpose Skills<a class="headerlink" href="#operators-for-general-purpose-skills" title="Permanent link">#</a></h2>
<p>The parameters for these operators include continuous variables produced by generators, which can be a uniform sampler, learned sampler, a sampling-based algorithm or an optimization algorithm. Please refer to the PDDLStream paper <a href="#references">[1]</a> for the format of those generators <code>(:stream</code>.</p>
<h3 id="pick"><strong>Pick</strong><a class="headerlink" href="#pick" title="Permanent link">#</a></h3>
<pre><code>(:action pick
  :parameters (?a ?o ?p ?g ?q ?t ?w)
  :precondition (and (KinWConf ?a ?o ?p ?g ?q ?t ?w)
                     (AtPose ?o ?p) (HandEmpty ?a)
                     (AtBConf ?q) (InWConf ?w)
                     (not (UnsafeApproach ?o ?p ?g))
                     (not (UnsafeATraj ?t))
                )
  :effect (and (AtGrasp ?a ?o ?g) (CanMove)
               (not (AtPose ?o ?p)) (not (HandEmpty ?a))
               (increase (total-cost) (PickCost))
          )
)
</code></pre>
<p>Pick with a single gripper grasp requires</p>
<ul>
<li>the joint sampling of grasp <code>?g</code> and arm trajectory <code>?t</code> with <code>(KinWConf ?a ?o ?p ?g ?q ?t ?w)</code>, which is a constraint that says <em>"pick with arm <code>?a</code> the object <code>?o</code> from its original pose <code>?p</code> by going to base configuration <code>?q</code> with arm trajectory <code>?t</code>, in world configuration <code>?w</code>"</em></li>
</ul>
<pre><code>(:stream sample-grasp
  :inputs (?o)
  :domain (Graspable ?o)
  :outputs (?g)
  :certified (Grasp ?o ?g)
)
(:stream inverse-kinematics-wconf
  :inputs (?a ?o ?p ?g ?w)
  :domain (and (Controllable ?a) (Pose ?o ?p) (Grasp ?o ?g) (WConf ?w))
  :outputs (?q ?t)
  :certified (and (BConf ?q) (ATraj ?t) (KinWConf ?a ?o ?p ?g ?q ?t ?w))
)
</code></pre>
<ul>
<li>checking that the grasp approach path (straight line) is free of collisions from movable objects with <code>(not (UnsafeApproach ?o ?p ?g))</code></li>
<li>checking that the arm path from default arm pose to grasp approach pose is free of collisions from movable objects with <code>(not (UnsafeATraj ?t))</code></li>
</ul>
<h3 id="place"><strong>Place</strong><a class="headerlink" href="#place" title="Permanent link">#</a></h3>
<pre><code>(:action place
  :parameters (?a ?o ?p ?g ?q ?t ?w)
  :precondition (and (KinWConf ?a ?o ?p ?g ?q ?t ?w)
                     (AtGrasp ?a ?o ?g) (AtBConf ?q) (InWConf ?w)
                     (not (UnsafePose ?o ?p))
                     (not (UnsafeApproach ?o ?p ?g))
                     (not (UnsafeATraj ?t))
                )
  :effect (and (AtPose ?o ?p) (HandEmpty ?a) (CanMove)
               (not (AtGrasp ?a ?o ?g))
               (increase (total-cost) (PlaceCost))
          )
)
</code></pre>
<p>Place, compared to pick, requires additionally</p>
<ul>
<li>sampling of placement pose <code>?p</code> on possible surfaces that supports the object</li>
</ul>
<pre><code>(:stream sample-pose
  :inputs (?o ?r)
  :domain (Stackable ?o ?r)
  :outputs (?p)
  :certified (and (Pose ?o ?p) (Supported ?o ?p ?r))
)
</code></pre>
<h3 id="grasp-handle"><strong>Grasp Handle</strong><a class="headerlink" href="#grasp-handle" title="Permanent link">#</a></h3>
<p>Handles are body links to grasp for changing joint positions or body poses. The Grasp Handle operator is similar to a pick. But the motion after a handle grasp is constraint by the category of object</p>
<ul>
<li>for <code>door</code> links (<em>one revolute joint</em>), the end-effector motion needs to be along a circular trajectory</li>
<li>for <code>drawer</code> links (<em>one prismatic joint</em>), the end-effector motion needs to be along a straight line</li>
<li>for <code>knob</code> links (<em>one revolute joint where the articulated link is the handle itself</em>), only the arm wrist link can move</li>
<li>for <code>cart</code> objects (<em>an array of prismatic joints</em>), the end-effector motion needs to be along a straight line</li>
<li>for <code>chair</code> objects (<em>an array of prismatic and revolute joints</em>), the end-effector motion needs to move on a plane parallel to the floor</li>
</ul>
<pre><code>(:action grasp_handle
  :parameters (?a ?o ?p ?g ?q ?aq1 ?aq2 ?t)
  :precondition (and (Joint ?o)
                     (KinGraspHandle ?a ?o ?p ?g ?q ?aq2 ?t)
                     (AtPosition ?o ?p) (HandEmpty ?a)
                     (AtBConf ?q) (AtAConf ?a ?aq1)
                )
  :effect (and (AtHandleGrasp ?a ?o ?g) (not (HandEmpty ?a))
               (not (CanMove)) (CanPull) (not (CanUngrasp))
               (not (AtAConf ?a ?aq1)) (AtAConf ?a ?aq2)
               (increase (total-cost) (PickCost))
          )
)
</code></pre>
<p>Handle grasps and grasping arm trajectories are sampled by the streams:</p>
<pre><code>(:stream sample-handle-grasp
  :inputs (?o)
  :domain (Joint ?o)
  :outputs (?g)
  :certified (HandleGrasp ?o ?g)
)
(:stream inverse-kinematics-grasp-handle
  :inputs (?a ?o ?p ?g)
  :domain (and (Controllable ?a) (Position ?o ?p) (HandleGrasp ?o ?g) (IsClosedPosition ?o ?p))
  :outputs (?q ?aq ?t)
  :certified (and (BConf ?q) (AConf ?a ?aq) (ATraj ?t) (KinGraspHandle ?a ?o ?p ?g ?q ?aq ?t))
)
</code></pre>
<p>For each of the first four types of articulated objects <code>?o</code>, we have a corresponding pull handle operator described in the next subsection.</p>
<p>Note that those four operators take the joint as input object instead of handle likes. That's because the handle link may just be one of many large links whose poses are changed with the joint position change, e.g. handle of fridge is a small part of the door links that's easy to grasp stably.</p>
<h3 id="pull-handle">Pull Handle<a class="headerlink" href="#pull-handle" title="Permanent link">#</a></h3>
<p><strong>Pull Drawer Handle</strong></p>
<pre><code>(:action pull_drawer_handle
  :parameters (?a ?o ?p1 ?p2 ?g ?q1 ?q2 ?bt)
  :precondition (and (Drawer ?o) (not (= ?p1 ?p2)) (CanPull)
                     (AtPosition ?o ?p1) (Position ?o ?p2)
                     (KinPullDrawerHandle ?a ?o ?p1 ?p2 ?g ?q1 ?q2 ?bt)
                     (AtHandleGrasp ?a ?o ?g) (AtBConf ?q1)
                     ;(not (UnsafeBTraj ?bt))
                )
  :effect (and (not (CanPull)) (CanUngrasp)
              (AtPosition ?o ?p2) (not (AtPosition ?o ?p1))
              (AtBConf ?q2) (not (AtBConf ?q1))
          )
)
</code></pre>
<p><strong>Pull Door Handle</strong></p>
<pre><code>(:action pull_door_handle
  :parameters (?a ?o ?p1 ?p2 ?g ?q1 ?q2 ?bt ?aq1 ?aq2 ?at ?w1 ?w2)
  :precondition (and (Door ?o) (not (= ?p1 ?p2)) (CanPull)
                     (AtPosition ?o ?p1) (Position ?o ?p2) (AtHandleGrasp ?a ?o ?g)
                     (KinPullDoorHandle ?a ?o ?p1 ?p2 ?g ?q1 ?q2 ?bt ?aq1 ?aq2 ?at)
                     (AtBConf ?q1) (AtAConf ?a ?aq1)
                     (InWConf ?w1) (WConf ?w2)
                     (NewWConfPst ?w1 ?o ?p2 ?w2)
                     ;(not (UnsafeApproach ?o ?p2 ?g))
                     ;(not (UnsafeATraj ?at))
                     ;(not (UnsafeBTraj ?bt))
                )
  :effect (and (not (CanPull)) (CanUngrasp)
              (AtPosition ?o ?p2) (not (AtPosition ?o ?p1))
              (AtBConf ?q2) (not (AtBConf ?q1))
              (AtAConf ?a ?aq2) (not (AtAConf ?a ?aq1))
              (InWConf ?w2) (not (InWConf ?w1))
          )
)
</code></pre>
<p><strong>Turn Knob</strong></p>
<pre><code>(:action turn_knob
  :parameters (?a ?o ?p1 ?p2 ?g ?q ?aq1 ?aq2 ?at)
  :precondition (and (Knob ?o) (not (= ?p1 ?p2)) (CanPull)
                     (AtPosition ?o ?p1) (Position ?o ?p2) (AtHandleGrasp ?a ?o ?g)
                     (KinTurnKnob ?a ?o ?p1 ?p2 ?g ?q ?aq1 ?aq2 ?at)
                     (AtBConf ?q) (AtAConf ?a ?aq1)
                     ;(not (UnsafeApproach ?o ?p2 ?g))
                     ;(not (UnsafeATraj ?at))
                     ;(not (UnsafeBTraj ?bt))
                )
  :effect (and (not (CanPull)) (CanUngrasp) (KnobTurned ?a ?o)
              (AtPosition ?o ?p2) (not (AtPosition ?o ?p1))
              (UngraspBConf ?q)
              (AtAConf ?a ?aq2) (not (AtAConf ?a ?aq1))
          )
)
</code></pre>
<p>The corresponding <strong>Ungrasp</strong> action is needed to break from this mode of motion planning:</p>
<pre><code>(:action ungrasp_handle
  :parameters (?a ?o ?p ?g ?q ?aq1 ?aq2 ?t)
  :precondition (and (Joint ?o) (AConf ?aq1) (AConf ?aq2) (AtPosition ?o ?p)
                     (KinUngraspHandle ?a ?o ?p ?g ?q ?aq1 ?aq2 ?t)
                     (AtHandleGrasp ?a ?o ?g) (CanUngrasp)
                     (AtBConf ?q) (UngraspBConf ?q) (AtAConf ?a ?aq1)
                )
  :effect (and (GraspedHandle ?o) (HandEmpty ?a) (CanMove)
               (not (AtHandleGrasp ?a ?o ?g))
               (not (AtAConf ?a ?aq1)) (AtAConf ?a ?aq2)
               (increase (total-cost) (PlaceCost))
          )
)
</code></pre>
<hr />
<h2 id="operators-for-symbolic-goals">Operators for Symbolic Goals<a class="headerlink" href="#operators-for-symbolic-goals" title="Permanent link">#</a></h2>
<hr />
<h3 id="references">References<a class="headerlink" href="#references" title="Permanent link">#</a></h3>
<ol>
<li>Garrett, Caelan Reed, Tomás Lozano-Pérez, and Leslie Pack Kaelbling. "PDDLStream: Integrating symbolic planners and blackbox samplers via optimistic adaptive planning." Proceedings of the International Conference on Automated Planning and Scheduling. Vol. 30. 2020.</li>
</ol>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../domain-predicates/" class="btn btn-neutral float-left" title="I) Predicates"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../domain-axioms/" class="btn btn-neutral float-right" title="III) Axioms">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../domain-predicates/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../domain-axioms/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
